# v3 更新日志

::: warning 注意：
这个页面不是 v4 更新日志。若要查看 v4 版本的更新日志，请查看 [GitHub Releases](https://github.com/bs-community/blessing-skin-server/releases) 页面。v3 版本已不再被 Blessing Skin Community 支持，所以这个页面不会得到更新。
:::

v3.5.0
==============
- **[新增]** 姗姗来迟的官方「插件市场」
- **[新增]** 全新的「插件管理」页面
- **[新增]** 自带更完善的用户邮箱验证功能（移除旧有的「注册邮箱验证」插件）
- **[新增]** 支持通过 Mailgun、Amazon SES、sendmail 等服务发送邮件
- **[新增]** 支持上传皮肤时自动检测 Steve / Alex 模型
- **[新增]** 支持拖放文件上传皮肤
- **[新增]** 材质云存储支持（「腾讯云 COS」「阿里云 OSS」「七牛云存储」插件）
- **[新增]** 支持更多的角色名规则（与 Mojang 一致、允许汉字等 CJK 字符、自定义正则表达式）
- **[新增]** 允许通过正则表达式自定义皮肤库材质名称规则
- **[新增]** 在皮肤库首页显示材质的「喜欢」计数
- **[新增]** 在皮肤库材质详情页面添加「快速使用」选项
- **[新增]** 允许在皮肤库材质详情页面直接修改皮肤的适用模型
- **[新增]** 选项「注册时要求填写游戏内角色名」（移除注册页面上的「注册成功后自动新建同名角色」）
- **[新增]** 选项「允许用户直接下载皮肤库中材质的原始文件」
- **[新增]** 允许为每一种支持的语言设置不同的站点名称、站点描述、公告、版权文字等内容
- **[新增]** 允许自定义程序的语言文件与视图文件
- **[新增]** 新插件：「单角色限制」「分享奖励积分」「邀请码注册」
- **[改进]** 不再强制要求安装 PHP fileinfo 扩展
- **[改进]** 更完善的数据对接（原数据对接插件已拆分为 Authme、CrazyLogin 与论坛数据对接三个插件）
- **[改进]** 提升获取静态内容（材质 PNG 文件、玩家 Json Profile 等）的性能
- **[改进]** 增强登录次数限制与密码重置功能的安全性
- **[改进]** 不允许普通管理员访问「插件市场」「插件管理」「检查更新」等页面
- **[改进]** 将「请求不存在的角色时返回 200 而不是 404」选项修改为返回 204
- **[改进]** 安装向导默认勾选「生成随机 APP_KEY 和 SALT 以保证安全」
- **[改进]** 更新 `.htaccess` 与 `web.config` 文件，修复可能的伪静态问题
- **[改进]** 翻新语言文件，更新程序文本
- **[改进]** 为一个全新的角色设置 alex 皮肤时自动设置其优先模型
- **[改进]** 为「角色管理」页面的「优先模型」设置项添加更详细的描述文字
- **[改进]** 更新「举报材质」插件，添加举报奖惩设置与多语言支持
- **[改进]** 更新「批量导入」插件，修复乱码问题，改进性能，支持一次性导入更多材质
- **[改进]** 更新「Yggdrasil API」插件，更完善的 Minecraft [外置登录系统](https://github.com/bs-community/yggdrasil-api/blob/master/CHANGELOG.md)
- **[改进]** 支持通过 UNIX Socket 连接 Redis（「Redis」插件已更新）
- **[改进]** 移除密码 Hash 算法 `CrazyCrypt1`
- **[改进]** 使用 `.env` 变量指定自动更新所用的更新源
- **[改进]** 使用 `MAIL_DRIVER` 而非 `MAIL_HOST` 判断是否关闭邮件发送功能
- **[改进]** 移除材质 PNG 文件响应中的 `Expires` 标头（已有 `Cache-Control` 标头）
- **[改进]** 改进后台用户管理、角色管理等页面的错误提示
- **[改进]** 在某些页面使用弹窗而非右上角的 Toast 提示来显示错误信息
- **[改进]** 在「严重错误」弹出框标题处添加指向 FAQ 的超链接
- **[改进]** 当邮件发送失败时记录详细的错误日志
- **[改进]** 添加对 `.env` 文件的读权限检测
- **[改进]** 更新 console 彩蛋的样式
- **[修复]** Alex 模型皮肤预览手臂像素错位的问题
- **[修复]** 某些页面上的 CSRF 与 XSS 漏洞
- **[修复]** 开启 CDN 时「插件管理」页面出现 `414 Request-URI Too Large` 的问题
- **[修复]** Json Profile 中 `Last-Modified` 响应标头中时区错误的问题
- **[修复]** 可能出现的 `Undefined property: stdClass::$column_name` 问题
- **[修复]** 密码长度上限在某些情况下由 32 变为 16 的问题
- **[修复]** 登录验证码为空时提示信息不符的问题
- **[插件开发][新增]** 允许插件定义对其他插件的依赖关系
- **[插件开发][新增]** 支持自动加载插件中的 composer 依赖库
- **[插件开发][新增]** 环境变量 `PLUGINS_DIR` 与 `PLUGINS_URL`，用于自定义插件加载目录
- **[插件开发][新增]** 添加新的全局依赖库 `guzzlehttp/guzzle`
- **[插件开发][改进]** 弃用 `App\Services\Utils` 工具类，请使用同功能的 helper function 替代
- **[插件开发][修复]** `Hook::addMenuItem` 无法添加至菜单末尾的问题

v3.4.0
==============
- **[新增]** 全新的 3D 皮肤预览库，支持双层皮肤和 Alex 模型！（感谢 [skinview3d](https://github.com/to2mbn/skinview3d)）
- **[新增]** 支持 SQLite 数据库（理论上也支持 PostgreSQL）
- **[新增]** 衣柜中添加「重置已选材质」的按钮
- **[新增]** 支持 PHP 7.2（需要安装补丁包，具体请查看：[在 PHP 7.2 上运行](https://github.com/printempw/blessing-skin-server/wiki/%E5%9C%A8-PHP-7.2-%E4%B8%8A%E8%BF%90%E8%A1%8C)）
- **[改进]** 调整密码长度上限为 32 个字符
- **[改进]** 你可以直接在侧边栏访问所有已启用插件的配置页面了
- **[改进]** 规避可能出现的越权操作角色的行为
- **[改进]** 当用户收藏至衣柜的材质被设为隐私或删除时，返还用户相应积分
- **[改进]** 优化后台管理面板首页上的 SQL 查询性能
- **[改进]** 调整管理面板首页上的「概览」图表样式
- **[改进]** 当检测到安装不完整时提示用户而不是强行覆盖安装，以避免可能出现的数据丢失
- **[改进]** 安装时检查主机是否启用 escapeshellarg 函数，如被禁用，请手动安装本程序
- **[改进]** 当普通用户访问被设置为隐私的材质时返回 403 而不是 404 #111
- **[修复]** Alex 模型皮肤的 2D 预览上出现的像素偏移问题
- **[修复]** Firefox 上「设为隐私」等按钮失效（地址栏显示 `javascript:xxx;`）的问题 #105
- **[修复]** IE 和 Edge 浏览器上自动语言检测失效，导致默认访问显示英文界面的问题
- **[修复]** 程序报错中可能出现的中文乱码问题

v3.3.2
===============
- **[修复]** 设置材质为隐私时检查积分，防止出现负数积分的情况
- **[修复]** 收藏材质至衣柜时可能出现的错误
- **[修复]** 衣柜物品重命名后不显示其材质类型的问题
- **[修复]** 加强密码重置操作的安全检查
- **[改进]** 更新 .htaccess 重写配置文件，排除可能的兼容性问题
- **[改进]** 关爱强迫症患者，根据窗口大小自动调整衣柜每一页显示的物品数 #89
- **[改进]** 添加适用于 Blessing Skin 插件的开源许可证例外情况 #98
- **[改进]** 注册时添加「自动创建与昵称同名的角色」选项
- **[改进]** 尝试避免因为站点地址后加上 index.php 而造成的资源加载错误 #101

v3.3.1
===============
- **[修复]** 修改密码后登出出错的问题
- **[修复]** 皮肤库无法上传 Alex 模型皮肤的问题
- **[修复]** 后台「用户管理」中管理员无法操作自己的问题
- **[修复]** 在衣柜中移除物品时报错的问题
- **[修复]** TextureController 中的多语言翻译
- **[修复]** 错误日志记录的问题
- **[改进]** 首页的响应式样式，修复双滚动条的问题 #80
- **[改进]** 调整用户反馈发送的频率
- **[改进]** 当后台「首页背景图」选项留空时使用默认背景图
- **[改进]** 当签到剩余时间小于一小时时显示具体分钟
- **[改进]** 一键升级中可能导致失败的问题
- **[改进]** 检查安装完整性时报错的中文翻译
- **[改进]** 报错展示并关闭后不会造成页面变形
- **[改进]** 可能造成清除视图缓存失败的问题

v3.3
===============
- **[新增]** 衣柜页面的无刷新分页与即时搜索
- **[新增]** 皮肤库页面的无刷新筛选、分页、搜索
- **[新增]** 皮肤库中「清除筛选」的选项
- **[新增]** 删除角色材质时可选择要删除的材质类型
- **[新增]** 可以在「管理面板」中修改角色名
- **[新增]** 在「用户管理」中显示用户拥有的角色数量
- **[新增]** 现在「管理面板」中「用户管理」与「角色管理」可相互跳转
- **[新增]** 在点击用户头像出现的菜单中添加到管理面板的链接
- **[新增]** 提供选项以自定义检测用户 IP 地址的方法
- **[新增]** 对 `storage`、`resources`、`plugins` 目录的写权限检查
- **[新增]** PHP 版本过低、Composer 依赖未安装时的中文报错
- **[新增]** 插件 name 定义重复时报错而不是静默覆盖
- **[新增]** 为 JavaScript 文件添加自动化测试（感谢 @g-plane 的帮助）
- **[新增]** 「配置生成」插件现在提供 CustomSkinLoader 的 ExtraList 下载支持
- **[新增]** Profile 文件缓存、举报材质、Yggdrasil API 支持等插件
- **[改进]** 上传页面重新选择材质文件后自动更新「材质名称」输入框的值
- **[改进]** 自动从其他人的衣柜中与角色上删除失效材质（被删除或被设为隐私）
- **[改进]** 点击「我的衣柜」页面的「齿轮」图标不再同时更新材质预览
- **[改进]** 「管理面板」中更改用户积分后输入框自动失去焦点
- **[改进]** 「用户管理」、「角色管理」、「插件管理」页面中列表加载的性能
- **[改进]** 「角色管理」修改角色名时的提示不再是「参考本站设置」
- **[改进]** 使用漂亮的 `sweetalert2` 替换管理面板中的原生对话框
- **[改进]** 让渡角色时输入 UID 可实时显示对应用户的昵称
- **[改进]** 重命名材质名称时输入框内自动填入原来的名称
- **[改进]** 与返还积分有关的文本将取决于「返还积分」选项是否开启
- **[改进]** 现在管理员无法操作其他管理员与超级管理员的角色
- **[改进]** 登录后重定向至上一个试图访问的地址
- **[改进]** 自动生成页面底部版权信息的年份
- **[改进]** 添加首页背景图片的占位高度
- **[改进]** 添加对高清皮肤格式的检测
- **[改进]** 增强数据对接插件的稳定性
- **[改进]** 调整登录页面的样式
- **[改进]** 皮肤库的使用体验
- **[改进]** 启用「数据对接」插件时合并用户中心首页与角色管理页面
- **[改进]** 弃用 Bower 与 Laravel Elixir，使用 Yarn 管理依赖，添加 ESLint 语法检查
- **[改进]** 使用 ES6 重写并模块化 JavaScript 代码
- **[改进]** 更新 AdminLTE、jQuery 等依赖库至最新版
- **[修复]** 皮肤站搜索页的 XSS 漏洞
- **[修复]** 语言文件中的拼写错误
- **[修复]** 更新个人资料后不跳转的问题
- **[修复]** 皮肤库中切换语言后不再会清除原来的筛选条件
- **[修复]** 修改邮箱时不检测新地址是否冲突的问题
- **[修复]** 点击无披风的角色时 3D 预览仍然显示披风的问题
- **[修复]** 管理面板中「角色管理」页面的材质预览链接
- **[修复]** 皮肤库中不显示上传者自己的隐私材质问题
- **[修复]** 为照顾 v2 用户，除了修改新密码外需要密码的地方要求改为最少 6 位
- **[修复]** 安装时超级管理员的密码长度最少为 8 位
- **[修复]** 对接 CrazyLogin 时的密码加密问题
- **[修复]** 当用户总积分低于积分倍率时出现的问题

v3.2.1
=============
- **[新增]** 安装时生成随机 APP_KEY & SALT（可选）
- **[新增]** 新的密码加密算法 —— 使用 PHP 自带的 password_hash()
- **[新增]** 便于插件开发的帮助函数 e.g. `plugin()` & `plugin_assets()`
- **[新增]** 错误页 / 安装页上可以选择语言了
- **[新增]** 为 JavaScript 添加了帮助函数 url()
- **[新增]** 匿名发送统计信息的选项
- **[新增]** 启用 / 禁用 / 删除插件时的回调函数定义
- **[新增]** 插件 package.json 文件中的 url 字段
- **[改进]** 移除页面上默认的面包屑元素
- **[改进]** assets 的目录结构
- **[改进]** 当配置项为空时加载默认的站点图标
- **[改进]** 现在用户密码最长可以设置 64 位
- **[改进]** 使用 hash_equals() 来对比密码 Hash 以避免时序攻击
- **[改进]** 加密 cookie 中存储的 token
- **[改进]** 自定义错误页面的样式
- **[改进]** 升级时清除视图缓存文件
- **[改进]** 更详细的错误提示 (for stupids)
- **[改进]** 现在你可以在每个页面的 F12 Console 上看到一个 badge 了（笑
- **[改进]** 在用户中心 / 管理面板的侧边栏上显示当前用户权限
- **[修复]** 用户 / 角色 / 插件管理页表格的横向滚动
- **[修复]** 无法搜索衣柜
- **[修复]** 弹出对话框的字体粗细
- **[修复]** 负载均衡 / 反向代理下的 HTTP/HTTPS 协议判断
- **[修复]** 某些加密方式不可用的问题
- **[修复]** 当积分消耗设置为 0 时出现 division by zero 的问题

v3.2.0
============
- **[新增]** 炫酷的插件系统！
- **[新增]** 完全国际化，支持中英文！
- **[新增]** 自定义站点图标的选项
- **[新增]** 收藏消耗积分的选项
- **[新增]** 返还积分的选项
- **[新增]** 自动判断资源文件的选项
- **[新增]** 站点公告现在支持 Markdown 排版了
- **[新增]** 运行时环境检查
- **[新增]** 右下角程序版权文字有多种样式可供选择（修改右下角将不再被允许）
- **[新增]** Memcahce 的支持
- **[新增]** 为 JavaScript 脚本添加了 `blessing` 变量，可获取程序基本信息（只包含版本等，不会泄露敏感信息）
- **[新增]** 现在在衣柜可以一起试穿皮肤和披风，并一起应用了
- **[新增]** 密码重置现在会留下记录
- **[新增]** JSON Profile 现在会带上 last-modified 头
- **[新增]** 用户注册和材质上传的图表
- **[改进]** 全新的首页！（还以一种样式的首页以插件形式提供）
- **[改进]** 更完善更稳定的一键更新系统（现在也有下载进度条了）
- **[改进]** 更灵活的更新源设置
- **[改进]** 更好的 用户 / 角色管理，现在可以无刷新地操作 / 分页了！
- **[改进]** 当 APP_DEBUG 关闭时显示更好看的错误页面
- **[改进]** 添加 RewriteBase 到 .htaccess
- **[改进]** 缓存、配置生成、数据对接等功能现在以插件的形式提供
- **[修复]** 当上传图片过大时出现「文件不能为空」
- **[修复]** 禁止中文角色名失效的问题
- **[修复]** 无法从衣柜中删除物品
- **[修复]** 安装在子目录时登出会跳转到奇怪的地方去
- **[修复]** 在未完全安装时再次运行安装程序时会出现错误
- **[修复]** location path 以 . 开始造成的 IIS 错误
- **[修复]** 当材质重复并取消上传时不删除缓存文件
- **[修复]** 当材质上传者被删除时访问材质详情页出现奇怪的问题

v3.1.2
================
- **[新增]** 管理面板首页添加概览图表
- **[新增]** 添加「从 v2 导入数据」项到菜单
- **[新增]** 最大允许上传大小的选项
- **[新增]** 衣柜搜索
- **[改进]** 优化性能
- **[改进]** 允许其他用户重新上传已上传的私密材质
- **[修复]** 与 undefined 的比较
- **[修复]** 当 return_200_when_notfound 开启时的 cache-control 头
- **[修复]** 安装页面上 PrettyPageException 的翻译问题
- **[修复]** 语言文件中的错误
- **[修复]** Json Profile 的 cache-control 头

v3.1.1
================
- **[修复]** 更新页面的 CDN 缓存控制
- **[修复]** JSON Profile 的 Cache-Control 头
- **[修复]** 皮肤库搜索页面
- **[修复]** 手机上看不见语言选单中的项目
- **[修复]** String.prototype.endsWith 的兼容性
- **[修复]** 上传时先选择材质类型造成的实时预览出错
- **[修复]** 使用 CDN 造成的 url() 问题
- **[修复]** 现在不会出现负数页数了
- **[修复]** 无法使用零点后可签到的问题
- **[修复]** 获取环境变量的问题
- **[修复]** 密码错误时的提示信息
- **[修复]** 无法展示 Flash Messages 的问题
- **[修复]** HTTP 错误页上国际化失效的问题
- **[修复]** 数据表前缀失效的问题
- **[修复]** 默认的 APP_KEY 长度问题
- **[改进]** 升级 phpdotenv 至 v2.4.0
- **[改进]** 错误页面的翻译字符串
- **[改进]** 登出后重新生成 SESSION ID
- **[改进]** 衣柜中更多按钮可能被 ADB 屏蔽的提示

v3.1
===========
- **[新增]** 全新的项目框架
- **[新增]** 重命名衣柜物品
- **[新增]** 缓存相关配置
- **[新增]** 材质预览、头像等的文件缓存
- **[新增]** 屌爆的国际化！
- **[改进]** 暂停 3D 预览同时停止旋转
- **[改进]** 默认打开 display_errors
- **[改进]** 部分主机读取不到 `$_ENV` 内容的情况
- **[改进]** 密码输入错误太多次时的提示
- **[改进]** 皮肤库按用户搜索不再显示 UID
- **[修复]** 双层皮肤的预览
- **[修复]** 相对 URL 的问题
- **[修复]** 安装在子目录的问题
- **[修复]** 上传页选择材质类型时实时预览的问题
- **[修复]** 让渡角色的 BUG
- **[修复]** 管理页上用户和角色搜索的问题

v3.0.4
==========
- **[新增]** 重新加入自动更新
- **[新增]** 更多的更新源
- **[改进]** 移动框架文件至 app/Core 目录
- **[改进]** 自动决定存储空间的显示单位
- **[改进]** 使用 SQL 来计算用户已使用的存储空间，提升性能
- **[改进]** 使用 callout 代替 alert
- **[改进]** 调整个性化配置页面的列比例
- **[改进]** 使上传页面模型选择更加醒目
- **[修复]** 卡「注册中」的问题
- **[修复]** 访问 /index.php 出现 404
- **[修复]** Migrations 的 BUG
- **[修复]** 更新日志不换行
- **[修复]** 清空角色材质时出现的问题 #31
- **[修复]** 依据 UID 查找皮肤库时分页的 URL 问题

v3.0.3
==========
- **[新增]** 单独设置私有材质的积分消耗
- **[新增]** 使用 sweetalert2 来呈现更好的通知
- **[新增]** 左下角版权文字自定义
- **[新增]** IIS 的 MIME 类型配置
- **[新增]** 可使用所拥有角色的角色名登录站点
- **[新增]** v2 用户的数据迁移
- **[修复]** 修复时区问题
- **[修复]** 皮肤库上传链接的相对路径 #27
- **[修复]** 数据表中某些字段的默认值
- **[修复]** 不再转义自定义 CSS/JS
- **[修复]** 计算皮肤库总页数的逻辑
- **[改进]** 使用 css 来省略过长材质名称
- **[改进]** 当材质失效时通知用户（或自动删除）

v3.0.2
==========
- **[新增]** 迁移 v2 用户皮肤至 v3 皮肤库，请访问 /setup/migrations
- **[新增]** 为头像添加 Query String 的选项（用于头像的 CDN 缓存）
- **[新增]** 检查更新功能（自动更新还没写好
- **[新增]** 评论脚本的占位符，可自动替换为材质的 id 等信息
- **[改进]** 使用 mbstring 来进行更好的中文分割
- **[改进]** 检查安装完整性的逻辑
- **[修复]** 首页的背景图片不能全屏
- **[修复]** 中文角色名的 Bug
- **[修复]** Bug of converting object to string
- **[修复]** 带 api 的 json 地址返回无法访问的 textures 地址

-----------------------

v3 之前的更新日志请自己去看 GitHub releases 吧。
